<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Title</title>
    <link rel="stylesheet" href="./style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body class="dark">

    <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-2 bg-dark">
        <div class="col-md-3 text-light ms-3">pawiki.xyz</div>

        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
            <li><a id="home-nav" href="#" class="nav-link px-2 link-secondary link-light">Home</a></li>
            <li><a id="docs-nav" href="#docs" class="nav-link px-2 link-secondary">Docs</a></li>
            <li><a href="https://github.com/asanull/pawiki.github.io" target="_blank"
                    class="nav-link px-2 link-secondary">Repo</a></li>
        </ul>
        <a id="toggle" href="#" class="col-md-3 text-end nav-link link-secondary ms-3">toggle</a>
    </header>

    <main>
        <div id="home"></div>
        <div id="docs" class="hidden">
            <div id="sidebar">
                <div class="flex-shrink-0 p-3 bg-dark" id="collapsible" style="width: 200px;">
                    <ul id="list" class="list-unstyled ps-0">
                    </ul>
                </div>
            </div>
            <div id="content" class="flex-grow-1">
            </div>
        </div>
    </main>

    <script>
        //// jQuery
        //#region add selectText() to jQuery
        jQuery.fn.selectText = function () {
            this.find('input').each(function () {
                if ($(this).prev().length == 0 || !$(this).prev().hasClass('p_copy')) {
                    $('<p class="p_copy" style="position: absolute; z-index: -1;"></p>').insertBefore($(
                        this));
                }
                $(this).prev().html($(this).val());
            });
            var doc = document;
            var element = this[0];
            if (doc.body.createTextRange) {
                var range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                var selection = window.getSelection();
                var range = document.createRange();
                range.selectNodeContents(element);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        };
        //#endregion

        let home = $('#home')[0]
        let docs = $('#docs')[0]
        docs.className = 'd-none'
        $('#home-nav').click(async event => {
            event.preventDefault();
            $('#home-nav')[0].classList.add('link-light')
            $('#docs-nav')[0].classList.remove('link-light')
            home.className = 'visible'
            docs.className = 'hidden'

            await new Promise(r => setTimeout(r, 500));
            docs.className = 'd-none'

        })
        $('#docs-nav').click(async event => {
            event.preventDefault();
            $('#docs-nav')[0].classList.add('link-light')
            $('#home-nav')[0].classList.remove('link-light')
            home.className = 'hidden'
            docs.className = 'visible'

            await new Promise(r => setTimeout(r, 500));
            home.className = 'd-none'
        })
        $('#toggle').click(event => {
            event.preventDefault();
            document.body.classList.toggle('dark');
            document.body.classList.toggle('light');
        });
    </script>

    <script>
        let list = []
        async function fetchDocs(callback) {

            // Find all the files in the docs directory

            const response = await fetch('/root.json');
            const root = JSON.parse(await response.text());

            root.directories.forEach(dir => {
                root[dir].forEach(file => {
                    root.filesRemaining++;
                })
            })

            root.directories.forEach(async directory => {

                let format = directory.replace(/\s/g, '-');

                let li = document.createElement('li')
                li.classList.add('mb-1')
                li.innerHTML = `
                    <button class="btn btn-toggle align-items-center text-white rounded collapsed"
                        data-bs-toggle="collapse" data-bs-target="#${format}-collapse" aria-expanded="false"
                        style="text-align: start; width: 100%;">
                        ${directory}
                    </button>
                    <div class="collapse show" id="${format}-collapse">
                        <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                        </ul>
                    </div>
                `
                $('#list').append(li)
                let collapse = $(`#${format}-collapse`)[0]

                root[directory].forEach(async file => {

                    let link = document.createElement('li')
                    link.innerHTML =
                        `<a href="#${format}.md" class="link-light rounded text-decoration-none" style="color: var(--bs-gray-500)">${file}</a>`
                    link.style.padding = "10px"
                    collapse.children[0].appendChild(link)

                    const response = await fetch(`/dist/${directory}/${file}.md`);
                    const data = await response.text();

                    let doc = {}
                    doc.file = file
                    doc.content = data
                    doc.link = link
                    list.push(doc)

                    link.style.position = 'relative'
                    link.style.top = "10px"
                    link.style.left = "10px"

                    root.filesRemaining--;
                    if (root.filesRemaining == 0) callback()
                })
                let br = document.createElement('br')
                collapse.children[0].appendChild(br)
            });
        }
    </script>

    <script>
        window.location.hash = '';

        async function setHomepage() {
            const response = await fetch('/README.md');
            const data = await response.text();
            home.innerHTML = data
        }
        setHomepage()

        function setHeight() {
            $('#collapsible')[0].style.height = window.innerHeight - $('header')[0].offsetHeight + 'px'
        }
        window.onresize = setHeight()
        setHeight()

        document.addEventListener('DOMContentLoaded', fetchDocs(() => {

            list.forEach(doc => {

                let element = document.createElement('div')
                element.classList.add('hidden')
                element.classList.add('doc')
                element.innerHTML = doc.content
                $('#content')[0].appendChild(element)
                
                doc.link.addEventListener('click', async () => {
                    $('.doc').addClass('hidden');
                    element.classList.add('visible');
                    element.classList.remove('hidden');
                })

            });

            $('pre').each(function (i, block) {
                $(block).click(function () {
                    $(this).selectText();
                });
            });

        }));
        
    </script>

    <script>
        $(document).ready(function () {
            $("body").tooltip({
                selector: '[data-toggle=tooltip]'
            });
        });
    </script>

</body>

</html>